set -e

DSHELP="Docker must be installed and running to execute detect-secrets!

To install docker using brew: brew install --cask docker
To start docker desktop app: open /Applications/Docker.app
You can bypass this hook using --no-verify option. USE AT YOUR OWN RISK!
https://git-scm.com/docs/githooks#_pre_commit"

echo 'Executing detect-secrets git pre-commit hook.'
if [[ $(docker info > /dev/null 2>&1 && echo $?) != 0 ]]; then
  echo "${DSHELP}"
  exit 1
else
  echo 'Scanning...'
  docker run -i --rm --volume `pwd`:/usr/src/app lirantal/detect-secrets --baseline .secrets.baseline --exclude-secrets '[a-fA-F0-9]{24}' --exclude-lines 'W/"[!#-\x7E]*"' $(git diff --staged --name-only)
fi
